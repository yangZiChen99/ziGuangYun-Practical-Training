# 5月9日实训内容

## SQL基础教程理论学习

**第四章**：

学习了**INSERT**语句、**DELETE**语句和**UPDATE**语句的使用方法以及注意事项；了解了事务的基本概念以及事务的创建（**BEGIN TRANSACTION；.......COMMIT;**）和取消(**ROLLBACK**);了解了事务的**ACID特性**。

## 课后作业

**第四章课后作业**

**4.1  A 先生在自己的计算机（电脑）上，使用 CREATE TABLE 语句创建出了一张空的 Product（商品）表，并执行了如下的 SQL 语句向其中插入数据。**

```sql
BEGIN TRANSACTION;
 INSERT INTO Product VALUES ('0001', 'T恤衫', 
'衣服', 1000, 500, '2008-09-20');
 INSERT INTO Product VALUES ('0002', '打孔器', 
'办公用品', 500, 320, '2008-09-11');
 INSERT INTO Product VALUES ('0003', '运动T恤', 
'衣服', 4000, 2800, NULL);
```

**紧接着，B 先生使用其他的计算机连接上该数据库，执行了如下 SELECT语句。这时 B 先生能得到怎样的查询结果呢？**

```sql
SELECT * FROM Product;
```

答：在 A 先生使用 COMMIT 确定该更新之前，B 先生无法看到 A 先生进行更新的结果，因此B先生无法查询到任何结果。

**4.2   说出该语句的执行结果。**

```sql
INSERT INTO Product SELECT * FROM Product;
```

答：该语句无法执行，因为在插入数据时违背了主键约束。

**4.3     以练习 4.2 中的 Product 表为基础，再创建另外一张包含利润列的新表ProductMargin（商品利润）。**

```sql
-- 商品利润表

CREATE TABLE ProductMargin

(product_id CHAR(4) NOT NULL,

 product_name VARCHAR(100) NOT NULL,

 sale_price INTEGER,

 purchase_price INTEGER,

 margin INTEGER,

 PRIMARY KEY(product_id));
```

**请写出向上述表中插入如下数据的 SQL 语句，其中的利润可以简单地通过对 Product 表中的数据进行计算（销售单价 - 进货单价）得出。**

答：

```sql
INSERT INTO ProductMargin 
(product_id, product_name, sale_price, purchase_price, margin)
SELECT 
product_id, product_name, sale_price, purchase_price, sale_price - purchase_price
 FROM Product;
```

**4.4 对练习 4.3 中的 ProductMargin 表的数据进行如下更改。1、将运动 T 恤的销售单价从 4000 日元下调至 3000 日元。2、根据上述结果再次计算运动 T 恤的利润。更改后的ProductMargin表如下所示。请写出能够实现该变更的SQL语句。删除的表无法通过sql语句直接恢复，只能重新创建。**

答：1、

```sql
UPDATE ProductMargin
 SET sale_price = 3000
 WHERE product_id = '0003';
```

​      2、

```sql
UPDATE ProductMargin
 SET margin = sale_price - purchase_price
 WHERE product_id = '0003';
```
